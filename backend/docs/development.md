# Development Guide

Welcome to the development guide for the Trading Bot Application. This document provides an overview of the project structure, setup instructions, best practices, and guidelines for contributing.

---

## Table of Contents

- [Overview](#overview)
- [Project Structure](#project-structure)
- [Setup Instructions](#setup-instructions)
  - [Prerequisites](#prerequisites)
  - [Installation](#installation)
  - [Environment Configuration](#environment-configuration)
- [Running the Application](#running-the-application)
- [Testing and Debugging](#testing-and-debugging)
- [Coding Conventions](#coding-conventions)
- [Contributing](#contributing)
- [Additional Resources](#additional-resources)

---

## Overview

The Trading Bot Application automates trading across multiple exchanges. Its core features include:

- **User & Role Management:** Role‑based access control with support for admin, exporter, and viewer roles.
- **Exchange Integration:** Connects with exchanges such as OKX, Bybit, and Bitget via REST and WebSocket APIs.
- **Real‑Time Data:** Uses WebSocket connections to stream market data and trading updates.
- **Performance Tracking:** Aggregates and stores performance data based solely on closed (realized) trades.
- **Error Handling:** Implements robust error handling using custom error classes and decorators.
- **Telegram Integration:** Sends notifications and processes commands through a Telegram bot.

---

## Project Structure

The project is organized into several key directories:

- **/app**
  - **/crud** – CRUD operations for models (users, accounts, bots, trades, etc.).
  - **/db** – Database connection management and initialization.
  - **/models** – Data models (entities) including users, accounts, trades, etc.
    - **/entities** – Core model definitions.
  - **/services** – Business logic and integrations with external systems:
    - **/auth** – Authentication, password management, and token handling.
    - **/exchange** – Exchange operations (REST and WebSocket integration).
    - **/performance** – Performance aggregation, calculation, and storage.
    - **/reference** – Model relationship and reference validation.
    - **/telegram** – Telegram notifications and command handling.
    - **/trading** – High‑level trading operations.
    - **/websocket** – WebSocket connection management and exchange‑specific clients.
  - **/docs** – Documentation (API docs, error references, etc.).
- **/logs** – (Optional) Logs generated by the application.

---

## Setup Instructions

### Prerequisites

- **Python 3.8+** – Ensure you have Python installed.
- **MongoDB** – A running MongoDB instance.
- **Virtual Environment** – Recommended for dependency management.

### Installation

1. **Clone the Repository:**

   ```bash
   git clone <repository_url>
   cd <repository_directory>
   ```

2. **Create and Activate a Virtual Environment:**

   ```bash
   python -m venv venv
   source venv/bin/activate  # On Windows, use venv\Scripts\activate
   ```

3. **Install Dependencies:**

   ```bash
   pip install -r requirements.txt
   ```

### Environment Configuration

All configuration settings are managed in the `.env.development` file located in the project root. This file defines settings for:

- Application metadata (name, version, API version)
- MongoDB connection details
- Security settings (secret key, token expiration, etc.)
- CORS and webhook configuration
- Telegram Bot credentials and messaging settings
- Cron job schedules
- Performance tracking and balance sync settings
- Exchange defaults and rate limiting
- Caching and monitoring options
- Debug and logging preferences
- Development-specific features

*Note:* Since the environment variables are stored in `.env.development`, you don’t need to manually configure them elsewhere for development purposes.

---

## Running the Application

1. **Ensure MongoDB is Running:**  
   Confirm that your MongoDB instance is up and running.

2. **Start the Application:**  
   Run the application using your preferred method. For example, if using Uvicorn as the ASGI server:

   ```bash
   uvicorn app.main:app --reload
   ```

3. **Monitor Logs and Notifications:**  
   - Logs are stored in the `/logs` directory (if enabled).
   - Telegram notifications and API documentation can be accessed as described in the documentation.

---

## Testing and Debugging

- **Unit Tests:**  
  Run tests using pytest:

  ```bash
  pytest
  ```

- **Debug Logging:**  
  Logging levels are configurable in the `.env.development` file. Adjust `LOG_LEVEL` to control verbosity.

- **Error Tracking:**  
  Refer to the `/docs/errors.md` file for an overview of error types and handling strategies.

---

## Coding Conventions

- **PEP 8 Compliance:**  
  Follow PEP 8 guidelines for Python code style.
- **Docstrings:**  
  Use descriptive docstrings for modules, classes, and methods.
- **Type Hints:**  
  Leverage type hints throughout the code for clarity and better static analysis.
- **Error Handling:**  
  Use the provided error handler decorators to ensure consistent error reporting.

---

## Contributing

1. **Fork the Repository**
2. **Create a Feature Branch**
3. **Commit Your Changes**  
   Use clear and descriptive commit messages.
4. **Submit a Pull Request**

Before contributing, please ensure your code passes all tests and follows the project’s coding conventions.

---

## Additional Resources

- [API Documentation](api.md) – Detailed API endpoints and request/response formats.
- [Error References](errors.md) – Overview of custom error types used throughout the application.

---

